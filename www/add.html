<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- https://css-tricks.com/drag-and-drop-file-uploading/ -->
    <!-- https://www.jqueryscript.net/form/Drag-Drop-File-Upload-Plugin-For-Bootstrap-dropzone.html -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Lööp Møth</title>

    <!-- Bootstrap core CSS -->
    <link href="https://bootswatch.com/4/lux/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Muli">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/add.css">
    <!--<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/css/bootstrap.css">-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-treeview.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
  </head>

  <body>
  
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container-fluid">
        <img src="eeeoooo.png" style="width: auto; height: 3rem; margin-right: 1rem;"><a class="navbar-brand" href="index.html">Lööp Møth</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="add.html">Add</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <div class="container" id="content">
      <div class="curtain">
        
      </div>
      <div class="popUp"><div id="tree">

        <ul style="list-style:none;font-size:large;">

          <ul style="list-style:none;font-size:large;">

            <ul style="list-style:none;font-size:large;">

              <li>
                <a data-ajax="true" data-ajax-method="POST" data-ajax-mode="replace" data-ajax-success="hideBranch('1','0')" data-ajax-update="#result_1" href="/Kategorie/List/1" id="+1">+</a>
                <a data-ajax="true" data-ajax-method="POST" data-ajax-mode="replace" data-ajax-success="hideBranch('1','1')" data-ajax-update="#result_1" href="/Kategorie/Clear" id="-1" style="display:none">-</a>
                <input id="Check_Cat" name="Check_Cat" type="checkbox" value="1"><input name="Check_Cat" type="hidden" value="false">
                <div class="category">Kategoria 1</div>
                <div id="result_1"></div>
              </li>
              <li>
                <a data-ajax="true" data-ajax-method="POST" data-ajax-mode="replace" data-ajax-success="hideBranch('2','0')" data-ajax-update="#result_2" href="/Kategorie/List/2" id="+2">+</a>
                <a data-ajax="true" data-ajax-method="POST" data-ajax-mode="replace" data-ajax-success="hideBranch('2','1')" data-ajax-update="#result_2" href="/Kategorie/Clear" id="-2" style="display:none">-</a>
                <input id="Check_Cat" name="Check_Cat" type="checkbox" value="2"><input name="Check_Cat" type="hidden" value="false">
                <div class="category">Kategoria 2</div>
                <div id="result_2"></div>
              </li>
            </ul>

      </div></div>
        <div class="dropzone"></div>
        <div class="element">
          <table class="table table-striped">
            <tr>
              <th scope="col"><label>Author:</label></th>
              <th scope="col"><input type="text" name="author" /></th>
            </tr>
            <tr>
              <th scope="col"><label>Title:</label></th>
              <th scope="col"><input type="text" name="title" /></th>
            </tr>
            <tr>
              <th scope="col"><label>Creator:</label></th>
              <th scope="col"><input type="text" name="creator" /></th>
            </tr>
            <tr>
              <th scope="col"><label>Subject:</label></th>
              <th scope="col"><input type="text" name="subject" /></th>
            </tr>
            <tr>
              <th scope="col"><label>Keywords:</label></th>
              <th scope="col"><input type="text" name="keywords" /></th>
            </tr>
            <tr>
              <th scope="col"><label>Categories:</label></th>
              <th scope="col"><input type="text" id="categories" /></th>
            </tr>
          </table>
        </div>
    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="js/skrypt.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="bootstrap/js/bootstrap.bundle.js"></script>
    <script src="js/bootstrap-treeview.js"></script>
    <script src="js/dropzone.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript">
      $(".popUp").hide();
      $(".curtain").hide();

      $(".dropzone").dropzone({
        url: 'upload.php'
      })

      $(".dropzone").hover(function(){
        $(".dropzone").css("color", "#676a6d");
        $(".dropzone").css("background-color", "rgba(0,0,0, 0.06)");
        $(".dropzone").css("border", "5px groove rgba(0,0,0,0.05)");
        },function(){ 
          $(".dropzone").css("color", "#919aa1");
         $(".dropzone").css("background-color", "rgba(0,0,0, 0.01)");
          $(".dropzone").css("border", "5px dashed rgba(0,0,0,0.05)");
       } 
      );

      function getTree() {
        var tree = //[{"text":"Kategoria 1","nodes":null},{"text":"Kategoria 2","nodes":[{"text":"Kategoria 3","nodes":null}]}];
        [
          {
            text: "Parent 1",
            nodes: [
              {
                text: "Child 1",
                nodes: [
                  {
                    text: "Grandchild 1",
                    nodes: [
                      {
                        text: "Grandgrandchild 1"
                      }
                    ]
                  },
                  {
                    text: "Grandchild 2"
                  }
                ]
              },
              {
                text: "Child 2"
              }
            ]
          },
          {
            text: "Parent 2"
          },
          {
            text: "Parent 3"
          },
          {
            text: "Parent 4"
          },
          {
            text: "Parent 5"
          }
        ];
        // Some logic to retrieve, or generate tree structure
        return tree;
      }

      //$('#tree').treeview({data: getTree()});
      // $('#tree').treeview({
      //   // The naming convention for callback's is to prepend with `on`
      //   // and capitalize the first letter of the event name
      //   // e.g. nodeSelected -> onNodeSelected
      //   data: getTree(),
      //   onNodeSelected: function(event, data) {
      //     //alert(data.nodes[0].text); //eto wazhnoe
      //
      //     checkIfNodeHasParent(data);
      //     checkIfNodeHasChildren(data);
      //     /*var parent=$('#tree').treeview('getParent', data);
      //     if(!isFunction(parent.text)){
      //       //alert(parent.text)
      //       $('#tree').treeview('unselectNode', [ parent, { silent: true } ]);
      //     }*/
      //   }
      // });

      function checkIfNodeHasParent(node){
        var parent=$('#tree').treeview('getParent', node);
        if(!isFunction(parent.text)){
          $('#tree').treeview('unselectNode', [ parent, { silent: true } ]);
          checkIfNodeHasParent(parent);
        }
        else{
          $('#tree').treeview('unselectNode', [ node, { silent: true } ]);
        }
      }

      function checkIfNodeHasChildren(node){
        //ad eto wazhnoe- dokończyć rekurencyjnie sprawdzanie dzieci

        //alert(Object.size(node.nodes));

        if(Object.size(node.nodes)>0){
          for(var i =0; i < Object.size(node.nodes); i++){
            var newnode = node.nodes[i];
            $('#tree').treeview('unselectNode', [ newnode, { silent: true } ]);
          }
        }
        else{
          //alert("niet");
          //return true;
        }
      }

      Object.size = function(obj) {
        var size = 0, key;
        for (key in obj) {
            if (obj.hasOwnProperty(key)) size++;
        }
        return size;
      };

      function unselectChildElement(item, index){
        //alert(item + " " + index );
        $('#tree').treeview('unselectNode', [ item, { silent: true } ]);
        //checkIfNodeHasChildren(item);
      }

      function isFunction(functionToCheck) {
        return functionToCheck && {}.toString.call(functionToCheck) === '[object Function]';
      }

      /*$('#tree').on('nodeSelected', function(event, data) {
        //var parent=$('#tree').treeview('getParent', data);
        if($('#tree').treeview('getParent', data.node)!==undefined){
          alert(data.node+" ma rodzica!");
        }
        else{
          alert(data.node+" nie ma rodzica!");
        }
      });*/

      $("#categories").click(function(){
        $(".curtain").show();
        $(".popUp").show("slow");
      });

      $(".curtain").click(function(){
        $(".curtain").hide();
        $(".popUp").hide("fast");

        var checked_ids = [];
        var checked_categories = [];
        $.each($("input[name='Check_Cat']:checked"), function(){
          checked_ids.push($(this).val());
          checked_categories.push($(this).parent().find(".category").text());
        });

        //alert(checked_ids);
        $("#categories").val(checked_categories);

      });

      $("#categories").keypress(function(e) {
        e.preventDefault();
      });

    </script>

  </body>

</html>